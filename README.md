# README: Модуль AI-ассистента (Neo OSI Backend)

## 1. Общее описание

Данный модуль является ядром интеллектуального ассистента в проекте **Neo OSI**. Его основная задача - автоматизация процесса создания юридических и бухгалтерских документов через интуитивно понятный диалоговый интерфейс. Модуль предоставляет API, которое позволяет фронтенд-приложению (PWA) вести многошаговый диалог с пользователем, собирать необходимые данные и генерировать на их основе готовые `.docx` файлы.

Это решение позволяет значительно сократить время на рутинные операции, минимизировать ошибки человеческого фактора и предоставить пользователям круглосуточный сервис по подготовке документов.

## 2. Ключевые возможности

- **Билингвальная поддержка (RU/KZ):** Система автоматически определяет язык пользователя и ведет весь диалог (ответы, вопросы, инструкции) на соответствующем языке.
- **Stateful (контекстный) диалог:** В отличие от простых чат-ботов, ассистент "помнит" контекст беседы. Он управляет состоянием пользователя, позволяя гибко переключаться между заполнением разных документов или выходить в режим общей консультации.
- **Динамическая генерация документов:** На основе выбранного шаблона AI генерирует уникальный список вопросов, а после получения данных формирует готовый `.docx` файл.
- **RAG (Retrieval-Augmented Generation):** Для ответов на общие вопросы используется векторная база знаний, созданная на основе нормативных документов. Это позволяет ассистенту давать консультации, основываясь на реальных данных, а не на общей информации из интернета.
- **Интегрированная бизнес-логика:** Реализована система тарифных планов ("Базовый", "Премиум") с ежемесячными лимитами на количество генерируемых документов.

## 3. Технологический стек

- **Backend:** NestJS, TypeScript
- **AI & LLM:** Google Gemini API (модели `gemini-1.5-pro` и `gemini-1.5-flash`), LangChain.js
- **Базы данных:** PostgreSQL (для хранения состояния пользователя и истории чата), In-memory Vector Store (для RAG)
- **Генерация документов:** `docxtemplater`
- **Prompt Engineering:** Разработана система многоуровневых промптов для решения задач определения намерений, генерации вопросов и извлечения структурированных данных.

## 4. Настройка и запуск

### 4.1. Предварительные требования
- Установлены Node.js (v18+), npm/yarn, Docker.
- Репозиторий проекта склонирован (`git clone -b dev ...`).
- Запущен контейнер с базой данных (`docker-compose up -d`).

### 4.2. Конфигурация
1. Создайте файл `.env` в корневой директории проекта.
2. Скопируйте в него содержимое из `example.env` или воспользуйтесь шаблоном ниже.
3. **Обязательно** заполните переменную `GEMINI_API_KEY` вашим ключом доступа к Google AI Studio.

```env
# Ключ для доступа к Google Gemini API
GEMINI_API_KEY=ВАШ_СЕКРЕТНЫЙ_КЛЮЧ_GEMINI

# Настройки подключения к базе данных (соответствуют docker-compose.yml)
DB_HOST=localhost
DB_PORT=5433
DB_USERNAME=admin
DB_PASSWORD=mysecretpassword
DB_DATABASE=neo_osi_db

# Секретный ключ для подписи JWT токенов
JWT_SECRET=THIS_IS_A_VERY_SECRET_AND_LONG_KEY_FOR_JWT
